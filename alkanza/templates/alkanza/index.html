<!doctype html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="http://maps.googleapis.com/maps/api/js"></script>
<script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>
  var map;
  var points = [];
  var singleMarker;
  var image = {
          url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
          size: new google.maps.Size(20, 32),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(0, 32)
        };
  var image2 = {
          url: 'http://photosinbox.com/wp-content/uploads/2013/04/flag-pointer.jpg',
          size: new google.maps.Size(20, 32),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(0, 32)
        };
  var image3 = {
          url: 'https://openclipart.org/download/256528/Green-Flag.svg',
          size: new google.maps.Size(20, 32),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(0, 32)
        };

  function initialize() {
    var dir = { lat: 41.879535, lng: -87.624333 };
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 15,
      center: dir
    });

    google.maps.event.addListener(map,'click', function(event) {
      addMarker(event.latLng, map);
    });
  }

  function addMarker(location, map) {
    marker = new google.maps.Marker({
      position: location,
      map: map
    });
    singleMarker = marker;
    google.maps.event.addListener(marker,'click', function(event){
      marker.setMap(null);
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);
</script>


<script>
var marker;
var pointByID = {};
{% for point in points %}
pointByID[{{point.id}}] = {
    name: "{{point.name}}",
    lat: {{point.latitude}},
    lng: {{point.longitude}}
    type: {{point.type}}

};
{% endfor %}
$(document).ready(function () {
    function activatePoints() {
        $('.point').each(function () {
            $(this).click(function() {
                var point = pointByID[this.id];
                var center = new google.maps.LatLng(point.lat, point.lng);
                if (marker) marker.setMap();
                marker = new google.maps.Marker({map: map, position: center});
                map.panTo(center);
            }).hover(
                function () {this.className = this.className.replace('OFF', 'ON');},
                function () {this.className = this.className.replace('ON', 'OFF');}
            );
        });
    }
    activatePoints();
});


function update(){
  switch($("#pointType").val()){
    case "1":
      singleMarker.setIcon(image);
      break;
    case "2":
      singleMarker.setIcon(image2);
      break;
    case "3":
      singleMarker.setIcon(image3);
      break;
  }
  singleMarker.setTitle($("#name").val());
};

function calcular(){

};

function guardar(){
  
};

</script>
<style>
    body {font-family: sans-serif}
    #map {width: 500px; height: 300px}
</style>
</head>
<body onload='initialize()'>
  <div id=div.eva>
    <select name="options">
    {% for evaluation in evaluations %}
        <option value={{ evaluation.id }} >{{ evaluation.name }}</option>
    {% endfor %}
    </select>
  </div>
  <div>
    <input type="text" name="evaluationName"></li>
  </div>
</br>
  <div id=map></div>
  <div>
    <div>
      <li>
        <span>Nombre: </span>
        <input type="text" name="name"></li>
      <li>
        <span>Tipo: </span>
       <select id='pointType'>
        {% for type in types %}
            <option value={{ type.id }} >{{type.name}}</option>
        {% endfor %}
      </select>
      </li>
    </div>
      <li>
        <button onclick="update()">Cambiar</button>
        <button onclick="calcular()">Calcular</button>
        <button onclick="guardar()">Guardar</button>
      </li>
  </div>
</body>
</html>
